<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wellness Quest</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 25%, #45b7d1 50%, #96ceb4 75%, #feca57 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      min-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    * {
      box-sizing: border-box;
    }
    
    .container {
      width: 90%;
      max-width: 1200px;
      margin: 20px auto;
    }
    
    .login-card, .dashboard-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.1);
    }
    
    .login-card {
      max-width: 450px;
      margin: 0 auto;
      transform: translateY(0);
      animation: floatIn 1s ease-out;
    }
    
    @keyframes floatIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    h1 {
      color: #2d3748;
      margin: 0 0 10px 0;
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
    }
    
    h2 {
      color: #2d3748;
      margin: 0 0 20px 0;
      font-size: 28px;
      font-weight: 700;
      text-align: center;
    }
    
    h3 {
      color: #4a5568;
      margin: 0 0 15px 0;
      font-size: 20px;
      font-weight: 600;
    }
    
    .subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 16px;
      text-align: center;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      color: #4a5568;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    input, select {
      width: 100%;
      padding: 16px 20px;
      border: 3px solid #e2e8f0;
      border-radius: 16px;
      font-size: 16px;
      transition: all 0.3s;
      background: rgba(255,255,255,0.8);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      background: rgba(255,255,255,1);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .btn {
      width: 100%;
      padding: 18px;
      border: none;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
    }
    
    .btn-primary:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #48bb78, #38a169);
      color: white;
      margin-top: 15px;
      box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
    }
    
    .btn-secondary:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(72, 187, 120, 0.6);
    }
    
    .btn-logout {
      background: linear-gradient(135deg, #fc8181, #f56565);
      color: white;
      width: auto;
      padding: 12px 24px;
      font-size: 14px;
      box-shadow: 0 4px 15px rgba(252, 129, 129, 0.4);
    }
    
    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(252, 129, 129, 0.6);
    }
    
    .error-message {
      background: linear-gradient(135deg, #fed7d7, #fbb6ce);
      color: #c53030;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      font-weight: 600;
      border-left: 4px solid #fc8181;
    }
    
    .success-message {
      background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
      color: #22543d;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      font-weight: 600;
      border-left: 4px solid #48bb78;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      border-radius: 20px;
      border: 2px solid rgba(102, 126, 234, 0.2);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .user-badge {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .stat-value {
      font-size: 42px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 15px 0;
    }
    
    .stat-label {
      color: #718096;
      font-size: 14px;
      font-weight: 600;
    }
    
    .progress-bar {
      background: rgba(226, 232, 240, 0.8);
      height: 16px;
      border-radius: 8px;
      overflow: hidden;
      margin: 20px 0;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .progress-fill {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      height: 100%;
      transition: width 0.5s ease;
      box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
    }
    
    .team-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .team-item {
      background: rgba(255, 255, 255, 0.8);
      padding: 20px;
      border-radius: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 2px solid rgba(226, 232, 240, 0.5);
      transition: all 0.3s;
    }
    
    .team-item:hover {
      transform: translateX(5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .team-item.current-team {
      border-color: #667eea;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .team-name {
      font-weight: 700;
      color: #2d3748;
      font-size: 18px;
    }
    
    .team-stats {
      display: flex;
      gap: 25px;
      font-size: 14px;
      color: #718096;
      font-weight: 600;
    }
    
    .hydration-status {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .hydration-good {
      background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
      color: #22543d;
    }
    
    .hydration-warning {
      background: linear-gradient(135deg, #feebc8, #f6ad55);
      color: #7c2d12;
    }
    
    .hydration-danger {
      background: linear-gradient(135deg, #fed7d7, #fc8181);
      color: #c53030;
    }
    
    .member-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }
    
    .member-item {
      display: flex;
      justify-content: space-between;
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .member-item:hover {
      background: rgba(255, 255, 255, 0.9);
      transform: translateX(3px);
    }
    
    .member-item.current-user {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
      font-weight: 700;
      border: 2px solid rgba(102, 126, 234, 0.3);
    }
    
    .penalty-badge {
      background: linear-gradient(135deg, #fed7d7, #fc8181);
      color: #c53030;
      padding: 4px 12px;
      border-radius: 8px;
      font-size: 12px;
      margin-left: 10px;
      font-weight: 700;
    }
    
    .journey-map {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 40px;
      border-radius: 24px;
      margin-bottom: 30px;
      text-align: center;
      border: 2px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    
    .journey-visual {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 40px 0;
      position: relative;
      padding: 20px 0;
    }
    
    .journey-path {
      flex: 1;
      height: 8px;
      background: linear-gradient(90deg, #e2e8f0 0%, #cbd5e0 100%);
      margin: 0 30px;
      position: relative;
      border-radius: 4px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .city-marker {
      position: absolute;
      top: -40px;
      transform: translateX(-50%);
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      color: #4a5568;
    }
    
    .city-flag {
      font-size: 32px;
      margin-bottom: 5px;
    }
    
    .city-name {
      background: rgba(255, 255, 255, 0.9);
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    
    .team-token {
      position: absolute;
      top: -20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 4px solid white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: left 0.8s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      color: white;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0) translateX(-50%); }
      40% { transform: translateY(-10px) translateX(-50%); }
      60% { transform: translateY(-5px) translateX(-50%); }
    }
    
    .journey-stats {
      display: flex;
      justify-content: space-around;
      margin-top: 30px;
      padding-top: 30px;
      border-top: 3px solid rgba(226, 232, 240, 0.5);
    }
    
    .journey-stat {
      text-align: center;
      padding: 20px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 16px;
      min-width: 120px;
    }
    
    .journey-stat-value {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .journey-stat-label {
      font-size: 12px;
      color: #718096;
      margin-top: 8px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .input-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .hidden {
      display: none;
    }
    
    .location-start, .location-end {
      font-size: 64px;
      animation: pulse 3s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container"><!-- Login Screen -->
   <div id="loginScreen" class="login-card">
    <h1 id="appTitle">üèÉ‚Äç‚ôÇÔ∏è Wellness Quest üåü</h1>
    <p class="subtitle" id="loginHeader">Welcome Back, Adventurer!</p>
    <div id="loginError" class="error-message hidden"></div>
    <div id="loginSuccess" class="success-message hidden"></div>
    <form id="loginForm">
     <div class="form-group"><label for="loginUsername">üéØ Username</label> <input type="text" id="loginUsername" required>
     </div>
     <div class="form-group"><label for="loginPassword">üîê Password</label> <input type="password" id="loginPassword" required>
     </div><button type="submit" class="btn btn-primary" id="loginBtn">üöÄ Start Adventure</button>
    </form><button class="btn btn-secondary" id="showRegisterBtn">‚ú® Join the Quest</button>
   </div><!-- Registration Screen -->
   <div id="registerScreen" class="login-card hidden">
    <h1>üåü Join the Adventure</h1>
    <p class="subtitle">Create your wellness warrior profile</p>
    <div id="registerError" class="error-message hidden"></div>
    <form id="registerForm">
     <div class="form-group"><label for="registerUsername">üéØ Choose Username</label> <input type="text" id="registerUsername" required>
     </div>
     <div class="form-group"><label for="registerPassword">üîê Create Password</label> <input type="password" id="registerPassword" required>
     </div>
     <div class="form-group"><label for="registerTeam">üèÜ Select Your Team</label> <select id="registerTeam" required> <option value="">Choose your squad...</option> <option value="team1">üöó Team Speedsters</option> <option value="team2">üö¢ Team Voyagers</option> <option value="team3">üöÄ Team Rockets</option> <option value="team4">üéØ Team Arrows</option> <option value="team5">‚≠ê Team Stars</option> <option value="team6">üé© Team Hats</option> <option value="team7">üëü Team Sneakers</option> </select>
     </div><button type="submit" class="btn btn-primary" id="registerBtn">üéâ Create Account</button>
    </form><button class="btn btn-secondary" id="showLoginBtn">‚¨ÖÔ∏è Back to Login</button>
   </div><!-- Dashboard -->
   <div id="dashboardScreen" class="dashboard-card hidden">
    <div class="header">
     <div>
      <h1 id="dashboardWelcome">üèÉ‚Äç‚ôÇÔ∏è Track Your Journey</h1>
      <p class="subtitle" id="journeyTitle">Japan to China Adventure - 7,730,000 Steps</p>
     </div>
     <div class="user-info"><span class="user-badge" id="userBadge"></span> <button class="btn btn-logout" id="logoutBtn">üëã Logout</button>
     </div>
    </div>
    <div id="updateSuccess" class="success-message hidden"></div><!-- Journey Map -->
    <div class="journey-map">
     <h2>üó∫Ô∏è Epic Journey Progress</h2>
     <div class="journey-visual">
      <div class="location-start">
       üáØüáµ
      </div>
      <div class="journey-path" id="journeyPath"><!-- City markers will be positioned along the path -->
       <div class="city-marker" style="left: 0%;">
        <div class="city-flag">
         üèôÔ∏è
        </div>
        <div class="city-name">
         Tokyo
        </div>
       </div>
       <div class="city-marker" style="left: 20%;">
        <div class="city-flag">
         ‚õ©Ô∏è
        </div>
        <div class="city-name">
         Osaka
        </div>
       </div>
       <div class="city-marker" style="left: 35%;">
        <div class="city-flag">
         üåä
        </div>
        <div class="city-name">
         Busan
        </div>
       </div>
       <div class="city-marker" style="left: 50%;">
        <div class="city-flag">
         üè¢
        </div>
        <div class="city-name">
         Seoul
        </div>
       </div>
       <div class="city-marker" style="left: 70%;">
        <div class="city-flag">
         üèõÔ∏è
        </div>
        <div class="city-name">
         Beijing
        </div>
       </div>
       <div class="city-marker" style="left: 85%;">
        <div class="city-flag">
         üåÜ
        </div>
        <div class="city-name">
         Shanghai
        </div>
       </div>
      </div>
      <div class="location-end">
       üá®üá≥
      </div>
     </div>
     <div class="journey-stats">
      <div class="journey-stat">
       <div class="journey-stat-value" id="totalStepsAll">
        0
       </div>
       <div class="journey-stat-label">
        Total Steps
       </div>
      </div>
      <div class="journey-stat">
       <div class="journey-stat-value" id="progressPercent">
        0%
       </div>
       <div class="journey-stat-label">
        Journey Complete
       </div>
      </div>
      <div class="journey-stat">
       <div class="journey-stat-value" id="daysRemaining">
        ‚àû
       </div>
       <div class="journey-stat-label">
        Days to Finish
       </div>
      </div>
     </div>
    </div><!-- Daily Input -->
    <div class="card">
     <h3>üìä Today's Activity Log</h3>
     <form id="activityForm">
      <div class="input-row">
       <div class="form-group"><label for="stepsInput">üë£ Steps Today</label> <input type="number" id="stepsInput" min="0" required placeholder="Enter your steps">
       </div>
       <div class="form-group"><label for="waterInput">üíß Water Intake (glasses)</label> <input type="number" id="waterInput" min="0" max="20" required placeholder="How many glasses?">
       </div>
       <div class="form-group"><label for="sittingInput">ü™ë Sitting Hours</label> <input type="number" id="sittingInput" min="0" max="24" step="0.5" required placeholder="Hours spent sitting">
       </div>
      </div><button type="submit" class="btn btn-primary" id="updateBtn">üéØ Update Progress</button>
     </form>
    </div><!-- Personal Stats -->
    <div class="grid">
     <div class="card">
      <h3>üèÜ Your Adventure Stats</h3>
      <div class="stat-value" id="userTotalSteps">
       0
      </div>
      <div class="stat-label">
       Your Total Steps
      </div>
      <div class="progress-bar">
       <div class="progress-fill" id="userProgress" style="width: 0%"></div>
      </div>
      <div class="stat-label">
       Personal Journey Contribution
      </div>
     </div>
     <div class="card">
      <h3>üë• Team Power</h3>
      <div class="stat-value" id="teamTotalSteps">
       0
      </div>
      <div class="stat-label">
       Team Total Steps
      </div>
      <div style="margin-top: 20px;"><span class="hydration-status" id="teamHydration">Calculating...</span>
      </div>
     </div>
    </div><!-- Team Leaderboard -->
    <div class="card">
     <h3>üèÖ Team Championship Leaderboard</h3>
     <div class="team-list" id="teamLeaderboard"></div>
    </div><!-- Team Members -->
    <div class="card">
     <h3>ü§ù Your Squad Members</h3>
     <div class="member-list" id="teamMembers"></div>
    </div>
   </div>
  </div>
  <script>
    const TOTAL_JOURNEY_STEPS = 7730000;
    const TEAM_TOKENS = {
      team1: { emoji: 'üöó', color: '#ff6b6b', name: 'Speedsters' },
      team2: { emoji: 'üö¢', color: '#4ecdc4', name: 'Voyagers' },
      team3: { emoji: 'üöÄ', color: '#45b7d1', name: 'Rockets' },
      team4: { emoji: 'üéØ', color: '#96ceb4', name: 'Arrows' },
      team5: { emoji: '‚≠ê', color: '#feca57', name: 'Stars' },
      team6: { emoji: 'üé©', color: '#ff9ff3', name: 'Hats' },
      team7: { emoji: 'üëü', color: '#54a0ff', name: 'Sneakers' }
    };
    
    let currentUser = null;
    let allUsers = [];
    
    const defaultConfig = {
      app_title: "Wellness Quest",
      journey_title: "Japan to China",
      login_header: "Welcome Back",
      dashboard_welcome: "Track Your Journey",
      background_color: "#ff6b6b",
      surface_color: "#ffffff",
      text_color: "#2d3748",
      primary_action_color: "#667eea",
      secondary_action_color: "#48bb78",
      font_family: "Inter",
      font_size: 16
    };
    
    const dataHandler = {
      onDataChanged(data) {
        allUsers = data;
        if (currentUser) {
          updateDashboard();
        }
      }
    };
    
    async function initApp() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error("Failed to initialize data SDK");
        }
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseSize = config.font_size || defaultConfig.font_size;
            const baseFontStack = '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
            
            document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
            
            document.getElementById('appTitle').textContent = `üèÉ‚Äç‚ôÇÔ∏è ${config.app_title || defaultConfig.app_title} üåü`;
            document.getElementById('loginHeader').textContent = config.login_header || defaultConfig.login_header;
            document.getElementById('dashboardWelcome').textContent = `üèÉ‚Äç‚ôÇÔ∏è ${config.dashboard_welcome || defaultConfig.dashboard_welcome}`;
            document.getElementById('journeyTitle').textContent = `${config.journey_title || defaultConfig.journey_title} Adventure - 7,730,000 Steps`;
            
            const h1Elements = document.querySelectorAll('h1');
            h1Elements.forEach(el => {
              el.style.fontSize = `${baseSize * 2.25}px`;
              el.style.color = config.text_color || defaultConfig.text_color;
            });
            
            const h2Elements = document.querySelectorAll('h2');
            h2Elements.forEach(el => {
              el.style.fontSize = `${baseSize * 1.75}px`;
              el.style.color = config.text_color || defaultConfig.text_color;
            });
            
            const h3Elements = document.querySelectorAll('h3');
            h3Elements.forEach(el => {
              el.style.fontSize = `${baseSize * 1.25}px`;
            });
            
            const bodyText = document.querySelectorAll('p, label, input, select, .stat-label, .team-stats, .member-item');
            bodyText.forEach(el => {
              el.style.fontSize = `${baseSize}px`;
            });
            
            const cards = document.querySelectorAll('.login-card, .dashboard-card, .card');
            cards.forEach(card => {
              card.style.background = `rgba(255, 255, 255, 0.95)`;
            });
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.background_color = value;
                    window.elementSdk.setConfig({ background_color: value });
                  }
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.surface_color = value;
                    window.elementSdk.setConfig({ surface_color: value });
                  }
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.text_color = value;
                    window.elementSdk.setConfig({ text_color: value });
                  }
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.primary_action_color = value;
                    window.elementSdk.setConfig({ primary_action_color: value });
                  }
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.secondary_action_color = value;
                    window.elementSdk.setConfig({ secondary_action_color: value });
                  }
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                if (window.elementSdk) {
                  window.elementSdk.config.font_family = value;
                  window.elementSdk.setConfig({ font_family: value });
                }
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                if (window.elementSdk) {
                  window.elementSdk.config.font_size = value;
                  window.elementSdk.setConfig({ font_size: value });
                }
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["app_title", config.app_title || defaultConfig.app_title],
            ["journey_title", config.journey_title || defaultConfig.journey_title],
            ["login_header", config.login_header || defaultConfig.login_header],
            ["dashboard_welcome", config.dashboard_welcome || defaultConfig.dashboard_welcome]
          ])
        });
      }
    }
    
    // Login Form
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      const user = allUsers.find(u => u.username === username && u.password === password);
      
      if (user) {
        currentUser = user;
        showDashboard();
        hideMessage('loginError');
      } else {
        showMessage('loginError', '‚ùå Invalid username or password. Try again, adventurer!');
      }
    });
    
    // Register Form
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (allUsers.length >= 999) {
        showMessage('registerError', '‚ö†Ô∏è Maximum limit of 999 adventurers reached. Please contact the quest master.');
        return;
      }
      
      const username = document.getElementById('registerUsername').value.trim();
      const password = document.getElementById('registerPassword').value;
      const teamId = document.getElementById('registerTeam').value;
      
      if (allUsers.find(u => u.username === username)) {
        showMessage('registerError', '‚ùå Username already taken by another adventurer!');
        return;
      }
      
      const teamMembers = allUsers.filter(u => u.team_id === teamId);
      if (teamMembers.length >= 7) {
        showMessage('registerError', 'üö´ This squad is full! Choose another team (maximum 7 warriors per team)');
        return;
      }
      
      const btn = document.getElementById('registerBtn');
      btn.disabled = true;
      btn.textContent = '‚ú® Creating your adventure...';
      
      const newUser = {
        id: Date.now().toString(),
        username,
        password,
        team_id: teamId,
        steps_today: 0,
        water_intake: 0,
        sitting_hours: 0,
        total_steps: 0,
        last_updated: new Date().toISOString()
      };
      
      if (window.dataSdk) {
        const result = await window.dataSdk.create(newUser);
        
        if (result.isOk) {
          showMessage('loginSuccess', 'üéâ Adventure profile created! Welcome to the quest!');
          document.getElementById('registerForm').reset();
          setTimeout(() => {
            document.getElementById('showLoginBtn').click();
          }, 1500);
        } else {
          showMessage('registerError', '‚ùå Failed to create your adventure profile. Try again!');
        }
      }
      
      btn.disabled = false;
      btn.textContent = 'üéâ Create Account';
    });
    
    // Activity Form
    document.getElementById('activityForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const steps = parseInt(document.getElementById('stepsInput').value);
      const water = parseInt(document.getElementById('waterInput').value);
      const sitting = parseFloat(document.getElementById('sittingInput').value);
      
      let effectiveSteps = steps;
      if (sitting > 4) {
        const penalty = Math.floor((sitting - 4) * 1000);
        effectiveSteps = Math.max(0, steps - penalty);
      }
      
      const btn = document.getElementById('updateBtn');
      btn.disabled = true;
      btn.textContent = '‚ö° Updating adventure log...';
      
      const updatedUser = {
        ...currentUser,
        steps_today: steps,
        water_intake: water,
        sitting_hours: sitting,
        total_steps: (currentUser.total_steps || 0) + effectiveSteps,
        last_updated: new Date().toISOString()
      };
      
      if (window.dataSdk) {
        const result = await window.dataSdk.update(updatedUser);
        
        if (result.isOk) {
          currentUser = updatedUser;
          let message = `üéØ Adventure log updated! +${effectiveSteps.toLocaleString()} steps added to your journey!`;
          if (sitting > 4) {
            message += ` ‚ö†Ô∏è Sitting penalty applied - keep moving, warrior!`;
          }
          showMessage('updateSuccess', message);
          document.getElementById('activityForm').reset();
          setTimeout(() => hideMessage('updateSuccess'), 4000);
        }
      }
      
      btn.disabled = false;
      btn.textContent = 'üéØ Update Progress';
    });
    
    // Navigation
    document.getElementById('showRegisterBtn').addEventListener('click', () => {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('registerScreen').classList.remove('hidden');
      hideMessage('loginError');
      hideMessage('loginSuccess');
    });
    
    document.getElementById('showLoginBtn').addEventListener('click', () => {
      document.getElementById('registerScreen').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
      hideMessage('registerError');
    });
    
    document.getElementById('logoutBtn').addEventListener('click', () => {
      currentUser = null;
      document.getElementById('dashboardScreen').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('loginForm').reset();
    });
    
    function showDashboard() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('dashboardScreen').classList.remove('hidden');
      const teamInfo = TEAM_TOKENS[currentUser.team_id];
      document.getElementById('userBadge').textContent = `${teamInfo.emoji} ${currentUser.username} - ${teamInfo.name}`;
      updateDashboard();
    }
    
    function updateDashboard() {
      const teamMembers = allUsers.filter(u => u.team_id === currentUser.team_id);
      const teamTotalSteps = teamMembers.reduce((sum, u) => sum + (u.total_steps || 0), 0);
      const allTotalSteps = allUsers.reduce((sum, u) => sum + (u.total_steps || 0), 0);
      
      document.getElementById('userTotalSteps').textContent = (currentUser.total_steps || 0).toLocaleString();
      document.getElementById('teamTotalSteps').textContent = teamTotalSteps.toLocaleString();
      document.getElementById('totalStepsAll').textContent = allTotalSteps.toLocaleString();
      
      const progressPercent = Math.min(100, (allTotalSteps / TOTAL_JOURNEY_STEPS) * 100);
      document.getElementById('progressPercent').textContent = progressPercent.toFixed(1) + '%';
      
      // Calculate estimated days remaining
      const avgStepsPerDay = allTotalSteps / Math.max(1, allUsers.length);
      const remainingSteps = TOTAL_JOURNEY_STEPS - allTotalSteps;
      const daysRemaining = remainingSteps > 0 ? Math.ceil(remainingSteps / Math.max(1, avgStepsPerDay)) : 0;
      document.getElementById('daysRemaining').textContent = daysRemaining > 0 ? daysRemaining : 'üéâ';
      
      const userContribution = currentUser.total_steps / TOTAL_JOURNEY_STEPS * 100;
      document.getElementById('userProgress').style.width = Math.min(100, userContribution) + '%';
      
      updateTeamHydration(teamMembers);
      updateTeamLeaderboard();
      updateTeamMembers(teamMembers);
      updateJourneyMap();
    }
    
    function updateTeamHydration(teamMembers) {
      const avgWater = teamMembers.reduce((sum, u) => sum + (u.water_intake || 0), 0) / teamMembers.length;
      const hydrationEl = document.getElementById('teamHydration');
      
      if (avgWater >= 8) {
        hydrationEl.textContent = 'üíß Perfectly Hydrated';
        hydrationEl.className = 'hydration-status hydration-good';
      } else if (avgWater >= 5) {
        hydrationEl.textContent = '‚ö†Ô∏è Needs More Water';
        hydrationEl.className = 'hydration-status hydration-warning';
      } else {
        hydrationEl.textContent = '‚ò†Ô∏è Dehydration Danger';
        hydrationEl.className = 'hydration-status hydration-danger';
      }
    }
    
    function updateTeamLeaderboard() {
      const teams = {};
      
      allUsers.forEach(user => {
        if (!teams[user.team_id]) {
          teams[user.team_id] = {
            id: user.team_id,
            totalSteps: 0,
            members: [],
            avgWater: 0
          };
        }
        teams[user.team_id].totalSteps += user.total_steps || 0;
        teams[user.team_id].members.push(user);
      });
      
      Object.values(teams).forEach(team => {
        team.avgWater = team.members.reduce((sum, u) => sum + (u.water_intake || 0), 0) / team.members.length;
      });
      
      const sortedTeams = Object.values(teams).sort((a, b) => b.totalSteps - a.totalSteps);
      
      const leaderboardEl = document.getElementById('teamLeaderboard');
      leaderboardEl.innerHTML = sortedTeams.map((team, index) => {
        const isCurrentTeam = team.id === currentUser.team_id;
        const teamInfo = TEAM_TOKENS[team.id];
        let hydrationStatus = '';
        if (team.avgWater < 5) hydrationStatus = '‚ò†Ô∏è';
        else if (team.avgWater < 8) hydrationStatus = '‚ö†Ô∏è';
        else hydrationStatus = 'üíß';
        
        const medals = ['ü•á', 'ü•à', 'ü•â'];
        const medal = index < 3 ? medals[index] : `#${index + 1}`;
        
        return `
          <div class="team-item ${isCurrentTeam ? 'current-team' : ''}">
            <div>
              <span class="team-name">${medal} ${teamInfo.emoji} ${teamInfo.name}</span>
              <span style="margin-left: 15px;">${hydrationStatus}</span>
            </div>
            <div class="team-stats">
              <span>üèÉ‚Äç‚ôÇÔ∏è ${team.totalSteps.toLocaleString()} steps</span>
              <span>üë• ${team.members.length} warriors</span>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function updateTeamMembers(teamMembers) {
      const sortedMembers = [...teamMembers].sort((a, b) => (b.total_steps || 0) - (a.total_steps || 0));
      
      const membersEl = document.getElementById('teamMembers');
      membersEl.innerHTML = sortedMembers.map((member, index) => {
        const isCurrentUser = member.id === currentUser.id;
        const penalty = member.sitting_hours > 4 ? `<span class="penalty-badge">-${Math.floor((member.sitting_hours - 4) * 1000)} sitting penalty</span>` : '';
        const rank = index === 0 ? 'üëë' : `#${index + 1}`;
        
        return `
          <div class="member-item ${isCurrentUser ? 'current-user' : ''}">
            <span>${rank} ${member.username} ${isCurrentUser ? '(You)' : ''}</span>
            <span>üèÉ‚Äç‚ôÇÔ∏è ${(member.total_steps || 0).toLocaleString()} steps ${penalty}</span>
          </div>
        `;
      }).join('');
    }
    
    function updateJourneyMap() {
      const teams = {};
      
      allUsers.forEach(user => {
        if (!teams[user.team_id]) {
          teams[user.team_id] = 0;
        }
        teams[user.team_id] += user.total_steps || 0;
      });
      
      const journeyPath = document.getElementById('journeyPath');
      
      // Remove existing tokens
      const existingTokens = journeyPath.querySelectorAll('.team-token');
      existingTokens.forEach(token => token.remove());
      
      Object.entries(teams).forEach(([teamId, steps]) => {
        const progress = Math.min(100, (steps / TOTAL_JOURNEY_STEPS) * 100);
        const teamInfo = TEAM_TOKENS[teamId];
        
        const token = document.createElement('div');
        token.className = 'team-token';
        token.style.left = progress + '%';
        token.style.background = teamInfo.color;
        token.textContent = teamInfo.emoji;
        token.title = `${teamInfo.name}: ${steps.toLocaleString()} steps (${progress.toFixed(1)}%)`;
        
        journeyPath.appendChild(token);
      });
    }
    
    function showMessage(id, text) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.classList.remove('hidden');
    }
    
    function hideMessage(id) {
      document.getElementById(id).classList.add('hidden');
    }
    
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9991db1cd701797b',t:'MTc2MjIzNTY1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
