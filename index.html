<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wellness Quest</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 25%, #45b7d1 50%, #96ceb4 75%, #feca57 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      min-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    * {
      box-sizing: border-box;
    }
    
    .container {
      width: 90%;
      max-width: 1200px;
      margin: 20px auto;
    }
    
    .login-card, .dashboard-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.1);
    }
    
    .login-card {
      max-width: 450px;
      margin: 0 auto;
      transform: translateY(0);
      animation: floatIn 1s ease-out;
    }
    
    @keyframes floatIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    h1 {
      color: #2d3748;
      margin: 0 0 10px 0;
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
    }
    
    h2 {
      color: #2d3748;
      margin: 0 0 20px 0;
      font-size: 28px;
      font-weight: 700;
      text-align: center;
    }
    
    h3 {
      color: #4a5568;
      margin: 0 0 15px 0;
      font-size: 20px;
      font-weight: 600;
    }
    
    .subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 16px;
      text-align: center;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      color: #4a5568;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    input, select {
      width: 100%;
      padding: 16px 20px;
      border: 3px solid #e2e8f0;
      border-radius: 16px;
      font-size: 16px;
      transition: all 0.3s;
      background: rgba(255,255,255,0.8);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      background: rgba(255,255,255,1);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .btn {
      width: 100%;
      padding: 18px;
      border: none;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
    }
    
    .btn-primary:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #48bb78, #38a169);
      color: white;
      margin-top: 15px;
      box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
    }
    
    .btn-secondary:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(72, 187, 120, 0.6);
    }
    
    .btn-logout {
      background: linear-gradient(135deg, #fc8181, #f56565);
      color: white;
      width: auto;
      padding: 12px 24px;
      font-size: 14px;
      box-shadow: 0 4px 15px rgba(252, 129, 129, 0.4);
    }
    
    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(252, 129, 129, 0.6);
    }
    
    .error-message {
      background: linear-gradient(135deg, #fed7d7, #fbb6ce);
      color: #c53030;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      font-weight: 600;
      border-left: 4px solid #fc8181;
    }
    
    .success-message {
      background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
      color: #22543d;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      font-weight: 600;
      border-left: 4px solid #48bb78;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      border-radius: 20px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      flex-wrap: wrap;
      gap: 15px;
    }
    
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        text-align: center;
        padding: 15px;
      }
      
      .header h1 {
        font-size: 24px !important;
        margin-bottom: 5px;
      }
      
      .header .subtitle {
        font-size: 14px;
        margin-bottom: 15px;
      }
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .user-badge {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .stat-value {
      font-size: 42px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 15px 0;
    }
    
    .stat-label {
      color: #718096;
      font-size: 14px;
      font-weight: 600;
    }
    
    .progress-bar {
      background: rgba(226, 232, 240, 0.8);
      height: 16px;
      border-radius: 8px;
      overflow: hidden;
      margin: 20px 0;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .progress-fill {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      height: 100%;
      transition: width 0.5s ease;
      box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
    }
    
    .team-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .team-item {
      background: rgba(255, 255, 255, 0.8);
      padding: 20px;
      border-radius: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 2px solid rgba(226, 232, 240, 0.5);
      transition: all 0.3s;
    }
    
    .team-item:hover {
      transform: translateX(5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .team-item.current-team {
      border-color: #667eea;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    
    .team-name {
      font-weight: 700;
      color: #2d3748;
      font-size: 18px;
    }
    
    .team-stats {
      display: flex;
      gap: 25px;
      font-size: 14px;
      color: #718096;
      font-weight: 600;
    }
    
    .hydration-status {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .hydration-good {
      background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
      color: #22543d;
    }
    
    .hydration-warning {
      background: linear-gradient(135deg, #feebc8, #f6ad55);
      color: #7c2d12;
    }
    
    .hydration-danger {
      background: linear-gradient(135deg, #fed7d7, #fc8181);
      color: #c53030;
    }
    
    .member-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }
    
    .member-item {
      display: flex;
      justify-content: space-between;
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .member-item:hover {
      background: rgba(255, 255, 255, 0.9);
      transform: translateX(3px);
    }
    
    .member-item.current-user {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
      font-weight: 700;
      border: 2px solid rgba(102, 126, 234, 0.3);
    }
    
    .penalty-badge {
      background: linear-gradient(135deg, #fed7d7, #fc8181);
      color: #c53030;
      padding: 4px 12px;
      border-radius: 8px;
      font-size: 12px;
      margin-left: 10px;
      font-weight: 700;
    }
    
    .journey-map {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 40px;
      border-radius: 24px;
      margin-bottom: 30px;
      text-align: center;
      border: 2px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    
    .journey-visual {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 40px 0;
      position: relative;
      padding: 20px 0;
    }
    
    .journey-path {
      flex: 1;
      height: 8px;
      background: linear-gradient(90deg, #e2e8f0 0%, #cbd5e0 100%);
      margin: 0 30px;
      position: relative;
      border-radius: 4px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .city-marker {
      position: absolute;
      top: -40px;
      transform: translateX(-50%);
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      color: #4a5568;
    }
    
    .city-flag {
      font-size: 32px;
      margin-bottom: 5px;
    }
    
    .city-name {
      background: rgba(255, 255, 255, 0.9);
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    
    .team-token {
      position: absolute;
      top: -20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 4px solid white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: left 0.8s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      color: white;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0) translateX(-50%); }
      40% { transform: translateY(-10px) translateX(-50%); }
      60% { transform: translateY(-5px) translateX(-50%); }
    }
    
    .journey-stats {
      display: flex;
      justify-content: space-around;
      margin-top: 30px;
      padding-top: 30px;
      border-top: 3px solid rgba(226, 232, 240, 0.5);
    }
    
    .journey-stat {
      text-align: center;
      padding: 20px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 16px;
      min-width: 120px;
    }
    
    .journey-stat-value {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .journey-stat-label {
      font-size: 12px;
      color: #718096;
      margin-top: 8px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .input-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .hidden {
      display: none;
    }
    
    .location-start, .location-end {
      font-size: 64px;
      animation: pulse 3s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    /* Mobile Responsive Styles */
    @media (max-width: 768px) {
      .container {
        width: 95%;
        margin: 10px auto;
      }
      
      .login-card, .dashboard-card {
        padding: 20px;
        margin: 10px;
      }
      
      h1 {
        font-size: 28px !important;
      }
      
      h2 {
        font-size: 22px !important;
      }
      
      h3 {
        font-size: 18px !important;
      }
      
      .grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .card {
        padding: 20px;
      }
      
      .input-row {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .journey-map {
        padding: 20px;
      }
      
      .journey-visual {
        margin: 20px 0;
        padding: 15px 0;
      }
      
      .journey-path {
        margin: 0 15px;
      }
      
      .location-start, .location-end {
        font-size: 48px;
      }
      
      .city-marker {
        font-size: 10px;
      }
      
      .city-flag {
        font-size: 24px;
      }
      
      .journey-stats {
        flex-direction: column;
        gap: 15px;
      }
      
      .journey-stat {
        padding: 15px;
        min-width: auto;
      }
      
      .team-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .team-stats {
        flex-direction: column;
        gap: 8px;
        font-size: 12px;
      }
      
      .member-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        font-size: 13px;
      }
      
      .user-info {
        flex-direction: column;
        gap: 10px;
      }
      
      .user-badge {
        font-size: 14px;
        padding: 10px 16px;
      }
      
      .btn-logout {
        font-size: 12px;
        padding: 8px 16px;
      }
      
      .stat-value {
        font-size: 32px;
      }
      
      .journey-stat-value {
        font-size: 22px;
      }
    }
    
    @media (max-width: 480px) {
      .login-card, .dashboard-card {
        padding: 15px;
      }
      
      .journey-visual {
        flex-direction: column;
        gap: 20px;
      }
      
      .journey-path {
        width: 100%;
        margin: 0;
        position: relative;
      }
      
      .city-marker {
        position: relative;
        top: auto;
        transform: none;
        display: inline-block;
        margin: 0 5px;
      }
      
      .team-token {
        position: relative;
        top: auto;
        transform: none;
        margin: 5px;
        animation: none;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container"><!-- Login Screen -->
   <div id="loginScreen" class="login-card">
    <h1 id="appTitle">ğŸƒâ€â™‚ï¸ Wellness Quest ğŸŒŸ</h1>
    <p class="subtitle" id="loginHeader">Welcome Back, Adventurer!</p>
    <div id="loginError" class="error-message hidden"></div>
    <div id="loginSuccess" class="success-message hidden"></div>
    <form id="loginForm">
     <div class="form-group"><label for="loginUsername">ğŸ¯ Username</label> <input type="text" id="loginUsername" required>
     </div>
     <div class="form-group"><label for="loginPassword">ğŸ” Password</label> <input type="password" id="loginPassword" required>
     </div><button type="submit" class="btn btn-primary" id="loginBtn">ğŸš€ Start Adventure</button>
    </form><button class="btn btn-secondary" id="showRegisterBtn">âœ¨ Join the Quest</button>
   </div><!-- Registration Screen -->
   <div id="registerScreen" class="login-card hidden">
    <h1>ğŸŒŸ Join the Adventure</h1>
    <p class="subtitle">Create your wellness warrior profile</p>
    <div id="registerError" class="error-message hidden"></div>
    <form id="registerForm">
     <div class="form-group"><label for="registerUsername">ğŸ¯ Choose Username</label> <input type="text" id="registerUsername" required>
     </div>
     <div class="form-group"><label for="registerPassword">ğŸ” Create Password</label> <input type="password" id="registerPassword" required>
     </div>
     <div class="form-group"><label for="registerTeam">ğŸ† Select Your Team</label> <select id="registerTeam" required> <option value="">Choose your squad...</option> <option value="team1">ğŸš— Team Speedsters</option> <option value="team2">ğŸš¢ Team Voyagers</option> <option value="team3">ğŸš€ Team Rockets</option> <option value="team4">ğŸ¯ Team Arrows</option> <option value="team5">â­ Team Stars</option> <option value="team6">ğŸ© Team Hats</option> <option value="team7">ğŸ‘Ÿ Team Sneakers</option> </select>
     </div><button type="submit" class="btn btn-primary" id="registerBtn">ğŸ‰ Create Account</button>
    </form><button class="btn btn-secondary" id="showLoginBtn">â¬…ï¸ Back to Login</button>
   </div><!-- Dashboard -->
   <div id="dashboardScreen" class="dashboard-card hidden">
    <div class="header">
     <div>
      <h1 id="dashboardWelcome">ğŸƒâ€â™‚ï¸ Track Your Journey</h1>
      <p class="subtitle" id="journeyTitle">Japan to China Adventure - 7,730,000 Steps</p>
     </div>
     <div class="user-info"><span class="user-badge" id="userBadge"></span> <button class="btn btn-secondary" id="profileBtn" style="width: auto; padding: 12px 24px; font-size: 14px; margin-right: 10px;">ğŸ‘¤ Profile</button> <button class="btn btn-logout" id="logoutBtn">ğŸ‘‹ Logout</button>
     </div>
    </div>
    <div id="updateSuccess" class="success-message hidden"></div><!-- Journey Map -->
    <div class="journey-map">
     <h2>ğŸ—ºï¸ Epic Journey Progress</h2>
     <div class="journey-visual">
      <div class="location-start">
       ğŸ‡¯ğŸ‡µ
      </div>
      <div class="journey-path" id="journeyPath"><!-- City markers will be positioned along the path -->
       <div class="city-marker" style="left: 0%;">
        <div class="city-flag">
         ğŸ™ï¸
        </div>
        <div class="city-name">
         Tokyo
        </div>
       </div>
       <div class="city-marker" style="left: 20%;">
        <div class="city-flag">
         â›©ï¸
        </div>
        <div class="city-name">
         Osaka
        </div>
       </div>
       <div class="city-marker" style="left: 35%;">
        <div class="city-flag">
         ğŸŒŠ
        </div>
        <div class="city-name">
         Busan
        </div>
       </div>
       <div class="city-marker" style="left: 50%;">
        <div class="city-flag">
         ğŸ¢
        </div>
        <div class="city-name">
         Seoul
        </div>
       </div>
       <div class="city-marker" style="left: 70%;">
        <div class="city-flag">
         ğŸ›ï¸
        </div>
        <div class="city-name">
         Beijing
        </div>
       </div>
       <div class="city-marker" style="left: 85%;">
        <div class="city-flag">
         ğŸŒ†
        </div>
        <div class="city-name">
         Shanghai
        </div>
       </div>
      </div>
      <div class="location-end">
       ğŸ‡¨ğŸ‡³
      </div>
     </div>
     <div class="journey-stats">
      <div class="journey-stat">
       <div class="journey-stat-value" id="totalStepsAll">
        0
       </div>
       <div class="journey-stat-label">
        Total Steps
       </div>
      </div>
      <div class="journey-stat">
       <div class="journey-stat-value" id="progressPercent">
        0%
       </div>
       <div class="journey-stat-label">
        Journey Complete
       </div>
      </div>
      <div class="journey-stat">
       <div class="journey-stat-value" id="daysRemaining">
        âˆ
       </div>
       <div class="journey-stat-label">
        Days to Finish
       </div>
      </div>
     </div>
    </div><!-- Daily Input -->
    <div class="card">
     <h3>ğŸ“Š Today's Activity Log</h3>
     <form id="activityForm">
      <div class="input-row">
       <div class="form-group"><label for="stepsInput">ğŸ‘£ Steps Today (Goal: 10,000)</label> <input type="number" id="stepsInput" min="0" required placeholder="Enter your steps">
       </div>
       <div class="form-group"><label for="waterInput">ğŸ’§ Water Intake (Goal: 8 cups = 2L)</label> <input type="number" id="waterInput" min="0" max="20" required placeholder="Number of 250ml cups">
       </div>
       <div class="form-group"><label for="sittingInput">ğŸª‘ Sitting Hours (Penalty if &gt;4hrs)</label> <input type="number" id="sittingInput" min="0" max="24" step="0.5" required placeholder="Hours spent sitting">
       </div>
      </div><button type="submit" class="btn btn-primary" id="updateBtn">ğŸ¯ Log Today's Activity</button>
     </form>
    </div><!-- Personal Stats -->
    <div class="grid">
     <div class="card">
      <h3>ğŸ† Your Adventure Stats</h3>
      <div class="stat-value" id="userTotalSteps">
       0
      </div>
      <div class="stat-label">
       Your Total Steps
      </div>
      <div class="progress-bar">
       <div class="progress-fill" id="userProgress" style="width: 0%"></div>
      </div>
      <div class="stat-label">
       Personal Journey Contribution
      </div>
     </div>
     <div class="card">
      <h3>ğŸ“ˆ Your Daily Progress</h3>
      <div id="personalChart" style="height: 200px; position: relative; background: rgba(255,255,255,0.5); border-radius: 12px; padding: 20px;">
       <div id="chartBars" style="display: flex; align-items: end; height: 160px; gap: 8px; justify-content: space-between;"></div>
       <div id="chartLabels" style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 12px; color: #718096;"></div>
      </div>
      <div style="margin-top: 15px; font-size: 14px; color: #718096; text-align: center;"><span style="display: inline-block; width: 12px; height: 12px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 2px; margin-right: 5px;"></span> Daily Steps (Last 7 Days)
      </div>
     </div>
     <div class="card">
      <h3>ğŸ¯ Today's Goals</h3>
      <div style="margin-bottom: 20px;">
       <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><span style="font-weight: 600;">ğŸ‘£ Steps Goal (10,000)</span> <span id="stepsGoalStatus" class="hydration-status">Not Started</span>
       </div>
       <div class="progress-bar">
        <div class="progress-fill" id="stepsGoalProgress" style="width: 0%"></div>
       </div>
       <div class="stat-label" id="stepsGoalText">
        0 / 10,000 steps
       </div>
      </div>
      <div style="margin-bottom: 20px;">
       <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><span style="font-weight: 600;">ğŸ’§ Water Goal (2L / 8 cups)</span> <span id="waterGoalStatus" class="hydration-status">Not Started</span>
       </div>
       <div class="progress-bar">
        <div class="progress-fill" id="waterGoalProgress" style="width: 0%"></div>
       </div>
       <div class="stat-label" id="waterGoalText">
        0 / 8 cups (0ml / 2000ml)
       </div>
      </div>
      <div>
       <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><span style="font-weight: 600;">ğŸª‘ Sitting Goal (â‰¤4 hours)</span> <span id="sittingGoalStatus" class="hydration-status">Not Started</span>
       </div>
       <div class="progress-bar">
        <div class="progress-fill" id="sittingGoalProgress" style="width: 0%"></div>
       </div>
       <div class="stat-label" id="sittingGoalText">
        0 / 4 hours max
       </div>
      </div>
     </div>
     <div class="card">
      <h3>ğŸ‘¥ Team Power</h3>
      <div class="stat-value" id="teamTotalSteps">
       0
      </div>
      <div class="stat-label">
       Team Total Steps
      </div>
      <div style="margin-top: 20px;"><span class="hydration-status" id="teamHydration">Calculating...</span>
      </div>
      <div style="margin-top: 15px;">
       <div style="font-size: 14px; color: #718096; margin-bottom: 8px;">
        Team Daily Goals Achievement
       </div>
       <div id="teamGoalsStats" style="font-size: 14px; font-weight: 600;"></div>
      </div>
     </div>
    </div><!-- Team Leaderboard -->
    <div class="card">
     <h3>ğŸ… Team Championship Leaderboard</h3>
     <div class="team-list" id="teamLeaderboard"></div>
    </div><!-- Team Members -->
    <div class="card">
     <h3>ğŸ¤ Your Squad Members</h3>
     <div class="member-list" id="teamMembers"></div>
    </div>
   </div><!-- Profile Screen -->
   <div id="profileScreen" class="dashboard-card hidden">
    <div class="header">
     <div>
      <h1>ğŸ‘¤ Your Profile</h1>
      <p class="subtitle">Manage your adventure settings</p>
     </div>
     <div class="user-info"><button class="btn btn-secondary" id="backToDashboardBtn" style="width: auto; padding: 12px 24px; font-size: 14px;">â¬…ï¸ Back to Dashboard</button>
     </div>
    </div>
    <div id="profileUpdateSuccess" class="success-message hidden"></div>
    <div class="card">
     <h3>ğŸ­ Avatar &amp; Personal Info</h3>
     <div style="display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap;">
      <div style="text-align: center; min-width: 120px;">
       <div id="avatarDisplay" style="width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 48px; color: white; margin: 0 auto 15px;">
        ğŸ‘¤
       </div><button class="btn btn-secondary" id="changeAvatarBtn" style="width: auto; padding: 8px 16px; font-size: 14px;">ğŸ“¸ Change Avatar</button>
      </div>
      <div style="flex: 1; min-width: 250px;">
       <form id="profileForm">
        <div class="form-group"><label for="profileEmail">ğŸ“§ Email</label> <input type="email" id="profileEmail" placeholder="your.email@example.com">
        </div>
        <div class="form-group"><label for="profilePhone">ğŸ“± Phone</label> <input type="tel" id="profilePhone" placeholder="+1 (555) 123-4567">
        </div>
        <div class="form-group"><label for="profileBio">ğŸ“ Bio</label> <input type="text" id="profileBio" placeholder="Tell us about yourself..." maxlength="100">
        </div><button type="submit" class="btn btn-primary" id="updateProfileBtn" style="width: auto; padding: 12px 24px; font-size: 14px;">ğŸ’¾ Update Profile</button>
       </form>
      </div>
     </div>
    </div><!-- Avatar Selection Modal -->
    <div id="avatarModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: none; align-items: center; justify-content: center;">
     <div id="avatarModalContent" style="background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; max-height: 80%; overflow-y: auto;">
      <h3 style="margin-top: 0;">ğŸ­ Choose Your Avatar</h3>
      <div id="avatarOptions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 15px; margin: 20px 0;"><!-- Avatar options will be populated here -->
      </div>
      <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;"><button class="btn btn-secondary" id="cancelAvatarBtn" style="width: auto; padding: 10px 20px; font-size: 14px;">âŒ Cancel</button>
      </div>
     </div>
    </div>
   </div><!-- Admin Panel -->
   <div id="adminScreen" class="dashboard-card hidden">
    <div class="header">
     <div>
      <h1>âš™ï¸ Admin Control Panel</h1>
      <p class="subtitle">Manage all wellness warriors and teams</p>
     </div>
     <div class="user-info"><button class="btn btn-secondary" id="backFromAdminBtn" style="width: auto; padding: 12px 24px; font-size: 14px;">â¬…ï¸ Back to Dashboard</button>
     </div>
    </div>
    <div id="adminSuccess" class="success-message hidden"></div>
    <div class="grid">
     <div class="card">
      <h3>ğŸ“Š System Overview</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 20px; margin: 20px 0;">
       <div style="text-align: center;">
        <div class="stat-value" id="adminTotalUsers" style="font-size: 32px;">
         0
        </div>
        <div class="stat-label">
         Total Users
        </div>
       </div>
       <div style="text-align: center;">
        <div class="stat-value" id="adminActiveTeams" style="font-size: 32px;">
         0
        </div>
        <div class="stat-label">
         Active Teams
        </div>
       </div>
       <div style="text-align: center;">
        <div class="stat-value" id="adminTotalSteps" style="font-size: 32px;">
         0
        </div>
        <div class="stat-label">
         Total Steps
        </div>
       </div>
      </div>
     </div>
     <div class="card">
      <h3>ğŸ—‘ï¸ Quick Actions</h3>
      <div style="display: flex; flex-direction: column; gap: 15px;"><button class="btn btn-secondary" id="resetDailyDataBtn" style="width: 100%;">ğŸ”„ Reset All Daily Data</button> <button class="btn btn-secondary" id="exportDataBtn" style="width: 100%;">ğŸ“Š Export User Data</button> <button class="btn btn-logout" id="clearAllDataBtn" style="width: 100%;">âš ï¸ Clear All Data (Danger!)</button>
      </div>
     </div>
    </div>
    <div class="card">
     <h3>ğŸ‘¥ User Management</h3>
     <div style="margin-bottom: 20px;"><input type="text" id="adminSearchInput" placeholder="ğŸ” Search users by username..." style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px;">
     </div>
     <div id="adminUserList" style="max-height: 400px; overflow-y: auto;"><!-- User list will be populated here -->
     </div>
    </div>
   </div>
  </div>
  <script>
    const TOTAL_JOURNEY_STEPS = 7730000;
    const TEAM_TOKENS = {
      team1: { emoji: 'ğŸš—', color: '#ff6b6b', name: 'Speedsters' },
      team2: { emoji: 'ğŸš¢', color: '#4ecdc4', name: 'Voyagers' },
      team3: { emoji: 'ğŸš€', color: '#45b7d1', name: 'Rockets' },
      team4: { emoji: 'ğŸ¯', color: '#96ceb4', name: 'Arrows' },
      team5: { emoji: 'â­', color: '#feca57', name: 'Stars' },
      team6: { emoji: 'ğŸ©', color: '#ff9ff3', name: 'Hats' },
      team7: { emoji: 'ğŸ‘Ÿ', color: '#54a0ff', name: 'Sneakers' }
    };
    
    let currentUser = null;
    let allUsers = [];
    
    const AVATAR_OPTIONS = ['ğŸ‘¤', 'ğŸ§‘â€ğŸ’¼', 'ğŸ‘©â€ğŸ’¼', 'ğŸ§‘â€ğŸ“', 'ğŸ‘©â€ğŸ“', 'ğŸ§‘â€âš•ï¸', 'ğŸ‘©â€âš•ï¸', 'ğŸ§‘â€ğŸ«', 'ğŸ‘©â€ğŸ«', 'ğŸ§‘â€ğŸ’»', 'ğŸ‘©â€ğŸ’»', 'ğŸ§‘â€ğŸ¨', 'ğŸ‘©â€ğŸ¨', 'ğŸ§‘â€ğŸ³', 'ğŸ‘©â€ğŸ³', 'ğŸ§‘â€ğŸ”§', 'ğŸ‘©â€ğŸ”§', 'ğŸ§‘â€ğŸš€', 'ğŸ‘©â€ğŸš€', 'ğŸ¦¸â€â™‚ï¸', 'ğŸ¦¸â€â™€ï¸', 'ğŸ§™â€â™‚ï¸', 'ğŸ§™â€â™€ï¸', 'ğŸ§šâ€â™‚ï¸', 'ğŸ§šâ€â™€ï¸', 'ğŸ§›â€â™‚ï¸', 'ğŸ§›â€â™€ï¸', 'ğŸ§œâ€â™‚ï¸', 'ğŸ§œâ€â™€ï¸', 'ğŸ§â€â™‚ï¸', 'ğŸ§â€â™€ï¸'];
    
    const defaultConfig = {
      app_title: "Wellness Quest",
      journey_title: "Japan to China",
      login_header: "Welcome Back",
      dashboard_welcome: "Track Your Journey",
      background_color: "#ff6b6b",
      surface_color: "#ffffff",
      text_color: "#2d3748",
      primary_action_color: "#667eea",
      secondary_action_color: "#48bb78",
      font_family: "Inter",
      font_size: 16
    };
    
    const dataHandler = {
      onDataChanged(data) {
        allUsers = data;
        if (currentUser) {
          updateDashboard();
        }
      }
    };
    
    async function initApp() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error("Failed to initialize data SDK");
        }
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseSize = config.font_size || defaultConfig.font_size;
            const baseFontStack = '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
            
            document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
            
            document.getElementById('appTitle').textContent = `ğŸƒâ€â™‚ï¸ ${config.app_title || defaultConfig.app_title} ğŸŒŸ`;
            document.getElementById('loginHeader').textContent = config.login_header || defaultConfig.login_header;
            document.getElementById('dashboardWelcome').textContent = `ğŸƒâ€â™‚ï¸ ${config.dashboard_welcome || defaultConfig.dashboard_welcome}`;
            document.getElementById('journeyTitle').textContent = `${config.journey_title || defaultConfig.journey_title} Adventure - 7,730,000 Steps`;
            
            const h1Elements = document.querySelectorAll('h1');
            h1Elements.forEach(el => {
              el.style.fontSize = `${baseSize * 2.25}px`;
              el.style.color = config.text_color || defaultConfig.text_color;
            });
            
            const h2Elements = document.querySelectorAll('h2');
            h2Elements.forEach(el => {
              el.style.fontSize = `${baseSize * 1.75}px`;
              el.style.color = config.text_color || defaultConfig.text_color;
            });
            
            const h3Elements = document.querySelectorAll('h3');
            h3Elements.forEach(el => {
              el.style.fontSize = `${baseSize * 1.25}px`;
            });
            
            const bodyText = document.querySelectorAll('p, label, input, select, .stat-label, .team-stats, .member-item');
            bodyText.forEach(el => {
              el.style.fontSize = `${baseSize}px`;
            });
            
            const cards = document.querySelectorAll('.login-card, .dashboard-card, .card');
            cards.forEach(card => {
              card.style.background = `rgba(255, 255, 255, 0.95)`;
            });
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.background_color = value;
                    window.elementSdk.setConfig({ background_color: value });
                  }
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.surface_color = value;
                    window.elementSdk.setConfig({ surface_color: value });
                  }
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.text_color = value;
                    window.elementSdk.setConfig({ text_color: value });
                  }
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.primary_action_color = value;
                    window.elementSdk.setConfig({ primary_action_color: value });
                  }
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.config.secondary_action_color = value;
                    window.elementSdk.setConfig({ secondary_action_color: value });
                  }
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                if (window.elementSdk) {
                  window.elementSdk.config.font_family = value;
                  window.elementSdk.setConfig({ font_family: value });
                }
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                if (window.elementSdk) {
                  window.elementSdk.config.font_size = value;
                  window.elementSdk.setConfig({ font_size: value });
                }
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["app_title", config.app_title || defaultConfig.app_title],
            ["journey_title", config.journey_title || defaultConfig.journey_title],
            ["login_header", config.login_header || defaultConfig.login_header],
            ["dashboard_welcome", config.dashboard_welcome || defaultConfig.dashboard_welcome]
          ])
        });
      }
    }
    
    // Login Form
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      const user = allUsers.find(u => u.username === username && u.password === password);
      
      if (user) {
        currentUser = user;
        showDashboard();
        hideMessage('loginError');
      } else {
        showMessage('loginError', 'âŒ Invalid username or password. Try again, adventurer!');
      }
    });
    
    // Register Form
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const btn = document.getElementById('registerBtn');
      
      // Prevent double submission
      if (btn.disabled) {
        return;
      }
      
      if (allUsers.length >= 999) {
        showMessage('registerError', 'âš ï¸ Maximum limit of 999 adventurers reached. Please contact the quest master.');
        return;
      }
      
      const username = document.getElementById('registerUsername').value.trim();
      const password = document.getElementById('registerPassword').value;
      const teamId = document.getElementById('registerTeam').value;
      
      if (allUsers.find(u => u.username === username)) {
        showMessage('registerError', 'âŒ Username already taken by another adventurer!');
        return;
      }
      
      const teamMembers = allUsers.filter(u => u.team_id === teamId);
      if (teamMembers.length >= 7) {
        showMessage('registerError', 'ğŸš« This squad is full! Choose another team (maximum 7 warriors per team)');
        return;
      }
      
      btn.disabled = true;
      btn.textContent = 'âœ¨ Creating your adventure...';
      
      const newUser = {
        id: `${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        username,
        password,
        team_id: teamId,
        steps_today: 0,
        water_intake: 0,
        sitting_hours: 0,
        total_steps: 0,
        last_updated: new Date().toISOString()
      };
      
      if (window.dataSdk) {
        const result = await window.dataSdk.create(newUser);
        
        if (result.isOk) {
          showMessage('loginSuccess', 'ğŸ‰ Adventure profile created! Welcome to the quest!');
          document.getElementById('registerForm').reset();
          setTimeout(() => {
            document.getElementById('showLoginBtn').click();
            hideMessage('loginSuccess');
          }, 1500);
        } else {
          showMessage('registerError', 'âŒ Failed to create your adventure profile. Try again!');
          btn.disabled = false;
          btn.textContent = 'ğŸ‰ Create Account';
        }
      } else {
        btn.disabled = false;
        btn.textContent = 'ğŸ‰ Create Account';
      }
    });
    
    // Activity Form
    document.getElementById('activityForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const steps = parseInt(document.getElementById('stepsInput').value);
      const water = parseInt(document.getElementById('waterInput').value);
      const sitting = parseFloat(document.getElementById('sittingInput').value);
      
      let effectiveSteps = steps;
      if (sitting > 4) {
        const penalty = Math.floor((sitting - 4) * 1000);
        effectiveSteps = Math.max(0, steps - penalty);
      }
      
      const btn = document.getElementById('updateBtn');
      btn.disabled = true;
      btn.textContent = 'âš¡ Logging daily entry...';
      
      const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format
      
      // Create a new daily entry record
      const dailyEntry = {
        id: `${currentUser.id}_${today}_${Date.now()}`,
        username: currentUser.username,
        team_id: currentUser.team_id,
        entry_date: today,
        steps_today: steps,
        water_intake: water,
        sitting_hours: sitting,
        effective_steps: effectiveSteps,
        daily_goal_steps: steps >= 10000,
        daily_goal_water: water >= 8,
        last_updated: new Date().toISOString()
      };
      
      // Update user's current stats
      const updatedUser = {
        ...currentUser,
        steps_today: steps,
        water_intake: water,
        sitting_hours: sitting,
        total_steps: (currentUser.total_steps || 0) + effectiveSteps,
        daily_goal_steps: steps >= 10000,
        daily_goal_water: water >= 8,
        last_updated: new Date().toISOString()
      };
      
      if (window.dataSdk) {
        // Create daily entry record
        const entryResult = await window.dataSdk.create(dailyEntry);
        
        if (entryResult.isOk) {
          // Update user record
          const userResult = await window.dataSdk.update(updatedUser);
          
          if (userResult.isOk) {
            currentUser = updatedUser;
            let message = `ğŸ¯ Daily entry logged! +${effectiveSteps.toLocaleString()} steps added to your journey!`;
            
            if (steps >= 10000) message += ` ğŸ† Steps goal achieved!`;
            if (water >= 8) message += ` ğŸ’§ Hydration goal achieved!`;
            if (sitting > 4) message += ` âš ï¸ Sitting penalty applied - keep moving!`;
            
            showMessage('updateSuccess', message);
            document.getElementById('activityForm').reset();
            setTimeout(() => hideMessage('updateSuccess'), 5000);
          }
        } else {
          showMessage('updateSuccess', 'âŒ Failed to log daily entry. Please try again.');
          setTimeout(() => hideMessage('updateSuccess'), 3000);
        }
      }
      
      btn.disabled = false;
      btn.textContent = 'ğŸ¯ Log Today\'s Activity';
    });
    
    // Navigation
    document.getElementById('showRegisterBtn').addEventListener('click', () => {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('registerScreen').classList.remove('hidden');
      hideMessage('loginError');
      hideMessage('loginSuccess');
    });
    
    document.getElementById('showLoginBtn').addEventListener('click', () => {
      document.getElementById('registerScreen').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
      hideMessage('registerError');
    });
    
    document.getElementById('logoutBtn').addEventListener('click', () => {
      currentUser = null;
      document.getElementById('dashboardScreen').classList.add('hidden');
      document.getElementById('profileScreen').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('loginForm').reset();
    });
    
    document.getElementById('profileBtn').addEventListener('click', () => {
      document.getElementById('dashboardScreen').classList.add('hidden');
      document.getElementById('profileScreen').classList.remove('hidden');
      loadUserProfile();
    });
    
    document.getElementById('backToDashboardBtn').addEventListener('click', () => {
      document.getElementById('profileScreen').classList.add('hidden');
      document.getElementById('dashboardScreen').classList.remove('hidden');
    });
    
    // Admin Panel Navigation
    document.getElementById('backFromAdminBtn').addEventListener('click', () => {
      document.getElementById('adminScreen').classList.add('hidden');
      document.getElementById('dashboardScreen').classList.remove('hidden');
    });
    
    // Admin access (secret key combination: Ctrl+Shift+A)
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.shiftKey && e.key === 'A' && currentUser) {
        document.getElementById('dashboardScreen').classList.add('hidden');
        document.getElementById('profileScreen').classList.add('hidden');
        document.getElementById('adminScreen').classList.remove('hidden');
        updateAdminPanel();
      }
    });
    
    // Admin Panel Functions
    document.getElementById('resetDailyDataBtn').addEventListener('click', async () => {
      if (!confirm('âš ï¸ This will reset all daily data (steps_today, water_intake, sitting_hours) for all users. Continue?')) return;
      
      const btn = document.getElementById('resetDailyDataBtn');
      btn.disabled = true;
      btn.textContent = 'ğŸ”„ Resetting...';
      
      let resetCount = 0;
      for (const user of allUsers) {
        if (user.steps_today || user.water_intake || user.sitting_hours) {
          const updatedUser = {
            ...user,
            steps_today: 0,
            water_intake: 0,
            sitting_hours: 0,
            last_updated: new Date().toISOString()
          };
          
          const result = await window.dataSdk.update(updatedUser);
          if (result.isOk) resetCount++;
        }
      }
      
      showMessage('adminSuccess', `âœ… Reset daily data for ${resetCount} users successfully!`);
      setTimeout(() => hideMessage('adminSuccess'), 3000);
      
      btn.disabled = false;
      btn.textContent = 'ğŸ”„ Reset All Daily Data';
    });
    
    document.getElementById('exportDataBtn').addEventListener('click', () => {
      const csvData = [
        ['Username', 'Team', 'Total Steps', 'Steps Today', 'Water Today', 'Sitting Hours', 'Last Updated'],
        ...allUsers.map(user => [
          user.username,
          TEAM_TOKENS[user.team_id]?.name || user.team_id,
          user.total_steps || 0,
          user.steps_today || 0,
          user.water_intake || 0,
          user.sitting_hours || 0,
          user.last_updated || ''
        ])
      ];
      
      const csvContent = csvData.map(row => row.join(',')).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `wellness_quest_data_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
      
      showMessage('adminSuccess', 'ğŸ“Š Data exported successfully!');
      setTimeout(() => hideMessage('adminSuccess'), 3000);
    });
    
    document.getElementById('clearAllDataBtn').addEventListener('click', async () => {
      const confirmation = prompt('âš ï¸ DANGER: This will delete ALL user data permanently! Type "DELETE ALL DATA" to confirm:');
      if (confirmation !== 'DELETE ALL DATA') return;
      
      const btn = document.getElementById('clearAllDataBtn');
      btn.disabled = true;
      btn.textContent = 'ğŸ—‘ï¸ Deleting...';
      
      let deleteCount = 0;
      for (const user of allUsers) {
        const result = await window.dataSdk.delete(user);
        if (result.isOk) deleteCount++;
      }
      
      showMessage('adminSuccess', `ğŸ—‘ï¸ Deleted ${deleteCount} user records. System reset complete.`);
      setTimeout(() => {
        hideMessage('adminSuccess');
        // Logout and return to login screen
        document.getElementById('logoutBtn').click();
      }, 3000);
      
      btn.disabled = false;
      btn.textContent = 'âš ï¸ Clear All Data (Danger!)';
    });
    
    document.getElementById('adminSearchInput').addEventListener('input', (e) => {
      updateAdminUserList(e.target.value.toLowerCase());
    });
    
    // Profile Management
    document.getElementById('changeAvatarBtn').addEventListener('click', () => {
      showAvatarModal();
    });
    
    document.getElementById('cancelAvatarBtn').addEventListener('click', (e) => {
      e.preventDefault();
      hideAvatarModal();
    });
    
    // Close modal when clicking outside the content
    document.getElementById('avatarModal').addEventListener('click', (e) => {
      if (e.target.id === 'avatarModal') {
        hideAvatarModal();
      }
    });
    
    document.getElementById('profileForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('profileEmail').value.trim();
      const phone = document.getElementById('profilePhone').value.trim();
      const bio = document.getElementById('profileBio').value.trim();
      
      const btn = document.getElementById('updateProfileBtn');
      btn.disabled = true;
      btn.textContent = 'ğŸ’¾ Updating...';
      
      const updatedUser = {
        ...currentUser,
        email: email,
        phone: phone,
        bio: bio,
        last_updated: new Date().toISOString()
      };
      
      if (window.dataSdk) {
        const result = await window.dataSdk.update(updatedUser);
        
        if (result.isOk) {
          currentUser = updatedUser;
          showMessage('profileUpdateSuccess', 'âœ… Profile updated successfully!');
          setTimeout(() => hideMessage('profileUpdateSuccess'), 3000);
        } else {
          showMessage('profileUpdateSuccess', 'âŒ Failed to update profile. Please try again.');
          setTimeout(() => hideMessage('profileUpdateSuccess'), 3000);
        }
      }
      
      btn.disabled = false;
      btn.textContent = 'ğŸ’¾ Update Profile';
    });
    
    function showDashboard() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('dashboardScreen').classList.remove('hidden');
      const teamInfo = TEAM_TOKENS[currentUser.team_id];
      document.getElementById('userBadge').textContent = `${teamInfo.emoji} ${currentUser.username} - ${teamInfo.name}`;
      loadUserProfile();
      updateDashboard();
    }
    
    function loadUserProfile() {
      // Load avatar
      const avatar = currentUser.avatar || 'ğŸ‘¤';
      document.getElementById('avatarDisplay').textContent = avatar;
      
      // Load profile data
      document.getElementById('profileEmail').value = currentUser.email || '';
      document.getElementById('profilePhone').value = currentUser.phone || '';
      document.getElementById('profileBio').value = currentUser.bio || '';
    }
    
    function showAvatarModal() {
      const modal = document.getElementById('avatarModal');
      const optionsContainer = document.getElementById('avatarOptions');
      
      optionsContainer.innerHTML = '';
      
      AVATAR_OPTIONS.forEach(avatar => {
        const avatarDiv = document.createElement('div');
        avatarDiv.style.cssText = `
          width: 60px; 
          height: 60px; 
          border-radius: 50%; 
          background: linear-gradient(135deg, #667eea, #764ba2); 
          display: flex; 
          align-items: center; 
          justify-content: center; 
          font-size: 32px; 
          color: white; 
          cursor: pointer; 
          transition: all 0.2s ease; 
          border: 3px solid transparent;
        `;
        avatarDiv.textContent = avatar;
        
        // Use a closure to capture the avatar value
        avatarDiv.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          selectAvatar(avatar);
        });
        
        avatarDiv.addEventListener('mouseover', function() {
          this.style.transform = 'scale(1.1)';
          this.style.borderColor = '#667eea';
        });
        
        avatarDiv.addEventListener('mouseout', function() {
          this.style.transform = 'scale(1)';
          this.style.borderColor = 'transparent';
        });
        
        optionsContainer.appendChild(avatarDiv);
      });
      
      modal.classList.remove('hidden');
      modal.style.display = 'flex';
    }
    
    function hideAvatarModal() {
      const modal = document.getElementById('avatarModal');
      modal.classList.add('hidden');
      modal.style.display = 'none';
    }
    
    async function selectAvatar(avatar) {
      const updatedUser = {
        ...currentUser,
        avatar: avatar,
        last_updated: new Date().toISOString()
      };
      
      if (window.dataSdk) {
        const result = await window.dataSdk.update(updatedUser);
        
        if (result.isOk) {
          currentUser = updatedUser;
          document.getElementById('avatarDisplay').textContent = avatar;
          hideAvatarModal();
          showMessage('profileUpdateSuccess', 'ğŸ­ Avatar updated successfully!');
          setTimeout(() => hideMessage('profileUpdateSuccess'), 3000);
        }
      }
    }
    
    function updateDashboard() {
      // Find current user in the updated data
      const updatedCurrentUser = allUsers.find(u => u.id === currentUser.id);
      if (updatedCurrentUser) {
        currentUser = updatedCurrentUser;
      }
      
      const teamMembers = allUsers.filter(u => u.team_id === currentUser.team_id);
      const teamTotalSteps = teamMembers.reduce((sum, u) => sum + (u.total_steps || 0), 0);
      const allTotalSteps = allUsers.reduce((sum, u) => sum + (u.total_steps || 0), 0);
      
      document.getElementById('userTotalSteps').textContent = (currentUser.total_steps || 0).toLocaleString();
      document.getElementById('teamTotalSteps').textContent = teamTotalSteps.toLocaleString();
      document.getElementById('totalStepsAll').textContent = allTotalSteps.toLocaleString();
      
      const progressPercent = Math.min(100, (allTotalSteps / TOTAL_JOURNEY_STEPS) * 100);
      document.getElementById('progressPercent').textContent = progressPercent.toFixed(1) + '%';
      
      // Calculate days remaining in 4-month program (120 days from start)
      const programStartDate = new Date(); // Program starts today
      const programEndDate = new Date(programStartDate);
      programEndDate.setDate(programStartDate.getDate() + 120); // 4 months = 120 days
      
      const today = new Date();
      const daysRemaining = Math.max(0, Math.ceil((programEndDate - today) / (1000 * 60 * 60 * 24)));
      document.getElementById('daysRemaining').textContent = daysRemaining > 0 ? daysRemaining : 'ğŸ‰ Complete!';
      
      const userContribution = (currentUser.total_steps || 0) / TOTAL_JOURNEY_STEPS * 100;
      document.getElementById('userProgress').style.width = Math.min(100, userContribution) + '%';
      
      updateDailyGoals();
      updatePersonalChart();
      updateTeamHydration(teamMembers);
      updateTeamGoalsStats(teamMembers);
      updateTeamLeaderboard();
      updateTeamMembers(teamMembers);
      updateJourneyMap();
    }
    
    function updatePersonalChart() {
      // Get user's daily entries for the last 7 days
      const userEntries = allUsers.filter(u => u.username === currentUser.username);
      const last7Days = [];
      
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        
        // Find entry for this date
        const dayEntry = userEntries.find(entry => {
          const entryDate = new Date(entry.last_updated || 0).toISOString().split('T')[0];
          return entryDate === dateStr;
        });
        
        last7Days.push({
          date: dateStr,
          steps: dayEntry ? (dayEntry.steps_today || 0) : 0,
          label: date.toLocaleDateString('en-US', { weekday: 'short' })
        });
      }
      
      const maxSteps = Math.max(...last7Days.map(d => d.steps), 10000);
      const chartBars = document.getElementById('chartBars');
      const chartLabels = document.getElementById('chartLabels');
      
      chartBars.innerHTML = '';
      chartLabels.innerHTML = '';
      
      last7Days.forEach(day => {
        const barHeight = Math.max(4, (day.steps / maxSteps) * 140);
        const isGoalMet = day.steps >= 10000;
        
        const bar = document.createElement('div');
        bar.style.cssText = `
          width: 24px;
          height: ${barHeight}px;
          background: ${isGoalMet ? 'linear-gradient(135deg, #48bb78, #38a169)' : 'linear-gradient(135deg, #667eea, #764ba2)'};
          border-radius: 4px 4px 0 0;
          position: relative;
          cursor: pointer;
          transition: all 0.2s ease;
        `;
        
        bar.title = `${day.label}: ${day.steps.toLocaleString()} steps${isGoalMet ? ' âœ…' : ''}`;
        
        bar.addEventListener('mouseover', () => {
          bar.style.transform = 'scale(1.1)';
        });
        
        bar.addEventListener('mouseout', () => {
          bar.style.transform = 'scale(1)';
        });
        
        chartBars.appendChild(bar);
        
        const label = document.createElement('div');
        label.textContent = day.label;
        label.style.cssText = 'flex: 1; text-align: center; font-weight: 600;';
        chartLabels.appendChild(label);
      });
    }
    
    function updateAdminPanel() {
      const uniqueUsers = {};
      allUsers.forEach(user => {
        if (!uniqueUsers[user.username]) {
          uniqueUsers[user.username] = { ...user, total_steps: 0 };
        }
        uniqueUsers[user.username].total_steps += (user.total_steps || 0);
      });
      
      const totalUsers = Object.keys(uniqueUsers).length;
      const activeTeams = new Set(Object.values(uniqueUsers).map(u => u.team_id)).size;
      const totalSteps = Object.values(uniqueUsers).reduce((sum, u) => sum + u.total_steps, 0);
      
      document.getElementById('adminTotalUsers').textContent = totalUsers;
      document.getElementById('adminActiveTeams').textContent = activeTeams;
      document.getElementById('adminTotalSteps').textContent = totalSteps.toLocaleString();
      
      updateAdminUserList();
    }
    
    function updateAdminUserList(searchTerm = '') {
      const uniqueUsers = {};
      allUsers.forEach(user => {
        if (!uniqueUsers[user.username]) {
          uniqueUsers[user.username] = { ...user, total_steps: 0, daily_entries: 0 };
        }
        uniqueUsers[user.username].total_steps += (user.total_steps || 0);
        uniqueUsers[user.username].daily_entries++;
        
        if (new Date(user.last_updated || 0) > new Date(uniqueUsers[user.username].last_updated || 0)) {
          uniqueUsers[user.username] = {
            ...uniqueUsers[user.username],
            ...user,
            total_steps: uniqueUsers[user.username].total_steps,
            daily_entries: uniqueUsers[user.username].daily_entries
          };
        }
      });
      
      const filteredUsers = Object.values(uniqueUsers).filter(user => 
        user.username.toLowerCase().includes(searchTerm)
      ).sort((a, b) => b.total_steps - a.total_steps);
      
      const userListEl = document.getElementById('adminUserList');
      userListEl.innerHTML = filteredUsers.map(user => {
        const teamInfo = TEAM_TOKENS[user.team_id];
        const avatar = user.avatar || 'ğŸ‘¤';
        
        return `
          <div class="member-item" style="justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 15px;">
              <span style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 18px; color: white;">${avatar}</span>
              <div>
                <div style="font-weight: 700; color: #2d3748;">${user.username}</div>
                <div style="font-size: 12px; color: #718096;">${teamInfo.emoji} ${teamInfo.name}</div>
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-weight: 600;">${user.total_steps.toLocaleString()} steps</div>
              <div style="font-size: 12px; color: #718096;">${user.daily_entries} entries</div>
            </div>
            <button class="btn btn-logout" onclick="deleteUser('${user.id}')" style="width: auto; padding: 6px 12px; font-size: 12px; margin-left: 15px;">ğŸ—‘ï¸ Delete</button>
          </div>
        `;
      }).join('');
    }
    
    async function deleteUser(userId) {
      if (!confirm('âš ï¸ Delete this user permanently?')) return;
      
      const userToDelete = allUsers.find(u => u.id === userId);
      if (!userToDelete) return;
      
      const result = await window.dataSdk.delete(userToDelete);
      if (result.isOk) {
        showMessage('adminSuccess', `ğŸ—‘ï¸ User "${userToDelete.username}" deleted successfully!`);
        setTimeout(() => hideMessage('adminSuccess'), 3000);
        updateAdminPanel();
      }
    }
    
    // Make deleteUser available globally for onclick handlers
    window.deleteUser = deleteUser;
    
    function updateDailyGoals() {
      const stepsToday = currentUser.steps_today || 0;
      const waterToday = currentUser.water_intake || 0;
      const sittingToday = currentUser.sitting_hours || 0;
      
      // Steps goal progress
      const stepsProgress = Math.min(100, (stepsToday / 10000) * 100);
      document.getElementById('stepsGoalProgress').style.width = stepsProgress + '%';
      document.getElementById('stepsGoalText').textContent = `${stepsToday.toLocaleString()} / 10,000 steps`;
      
      const stepsGoalEl = document.getElementById('stepsGoalStatus');
      if (stepsToday >= 10000) {
        stepsGoalEl.textContent = 'ğŸ† Achieved!';
        stepsGoalEl.className = 'hydration-status hydration-good';
      } else if (stepsToday >= 5000) {
        stepsGoalEl.textContent = 'ğŸ”¥ Halfway!';
        stepsGoalEl.className = 'hydration-status hydration-warning';
      } else if (stepsToday > 0) {
        stepsGoalEl.textContent = 'ğŸš¶â€â™‚ï¸ Started';
        stepsGoalEl.className = 'hydration-status hydration-warning';
      } else {
        stepsGoalEl.textContent = 'ğŸ˜´ Not Started';
        stepsGoalEl.className = 'hydration-status hydration-danger';
      }
      
      // Water goal progress
      const waterProgress = Math.min(100, (waterToday / 8) * 100);
      const waterMl = waterToday * 250;
      document.getElementById('waterGoalProgress').style.width = waterProgress + '%';
      document.getElementById('waterGoalText').textContent = `${waterToday} / 8 cups (${waterMl}ml / 2000ml)`;
      
      const waterGoalEl = document.getElementById('waterGoalStatus');
      if (waterToday >= 8) {
        waterGoalEl.textContent = 'ğŸ’§ Hydrated!';
        waterGoalEl.className = 'hydration-status hydration-good';
      } else if (waterToday >= 4) {
        waterGoalEl.textContent = 'ğŸ¥¤ Halfway';
        waterGoalEl.className = 'hydration-status hydration-warning';
      } else if (waterToday > 0) {
        waterGoalEl.textContent = 'ğŸ’¦ Started';
        waterGoalEl.className = 'hydration-status hydration-warning';
      } else {
        waterGoalEl.textContent = 'ğŸœï¸ Dry';
        waterGoalEl.className = 'hydration-status hydration-danger';
      }
      
      // Sitting goal progress (reverse - less sitting is better)
      const sittingProgress = Math.min(100, (sittingToday / 4) * 100);
      document.getElementById('sittingGoalProgress').style.width = sittingProgress + '%';
      document.getElementById('sittingGoalText').textContent = `${sittingToday} / 4 hours max`;
      
      const sittingGoalEl = document.getElementById('sittingGoalStatus');
      if (sittingToday <= 4) {
        sittingGoalEl.textContent = 'âœ… Great!';
        sittingGoalEl.className = 'hydration-status hydration-good';
      } else if (sittingToday <= 6) {
        sittingGoalEl.textContent = 'âš ï¸ Too Much';
        sittingGoalEl.className = 'hydration-status hydration-warning';
      } else {
        sittingGoalEl.textContent = 'ğŸš¨ Danger Zone';
        sittingGoalEl.className = 'hydration-status hydration-danger';
      }
    }
    
    function updateTeamGoalsStats(teamMembers) {
      const stepsAchievers = teamMembers.filter(u => (u.steps_today || 0) >= 10000).length;
      const waterAchievers = teamMembers.filter(u => (u.water_intake || 0) >= 8).length;
      const totalMembers = teamMembers.length;
      
      const statsEl = document.getElementById('teamGoalsStats');
      statsEl.innerHTML = `
        <div style="margin-bottom: 5px;">ğŸ‘£ Steps Goals: ${stepsAchievers}/${totalMembers} members (${Math.round(stepsAchievers/totalMembers*100)}%)</div>
        <div>ğŸ’§ Water Goals: ${waterAchievers}/${totalMembers} members (${Math.round(waterAchievers/totalMembers*100)}%)</div>
      `;
    }
    
    function updateTeamHydration(teamMembers) {
      const avgWater = teamMembers.reduce((sum, u) => sum + (u.water_intake || 0), 0) / teamMembers.length;
      const hydrationEl = document.getElementById('teamHydration');
      
      if (avgWater >= 8) {
        hydrationEl.textContent = 'ğŸ’§ Perfectly Hydrated';
        hydrationEl.className = 'hydration-status hydration-good';
      } else if (avgWater >= 5) {
        hydrationEl.textContent = 'âš ï¸ Needs More Water';
        hydrationEl.className = 'hydration-status hydration-warning';
      } else {
        hydrationEl.textContent = 'â˜ ï¸ Dehydration Danger';
        hydrationEl.className = 'hydration-status hydration-danger';
      }
    }
    
    function updateTeamLeaderboard() {
      const teams = {};
      
      allUsers.forEach(user => {
        if (!teams[user.team_id]) {
          teams[user.team_id] = {
            id: user.team_id,
            totalSteps: 0,
            members: [],
            avgWater: 0
          };
        }
        teams[user.team_id].totalSteps += user.total_steps || 0;
        teams[user.team_id].members.push(user);
      });
      
      Object.values(teams).forEach(team => {
        team.avgWater = team.members.reduce((sum, u) => sum + (u.water_intake || 0), 0) / team.members.length;
      });
      
      const sortedTeams = Object.values(teams).sort((a, b) => b.totalSteps - a.totalSteps);
      
      const leaderboardEl = document.getElementById('teamLeaderboard');
      leaderboardEl.innerHTML = sortedTeams.map((team, index) => {
        const isCurrentTeam = team.id === currentUser.team_id;
        const teamInfo = TEAM_TOKENS[team.id];
        let hydrationStatus = '';
        if (team.avgWater < 5) hydrationStatus = 'â˜ ï¸';
        else if (team.avgWater < 8) hydrationStatus = 'âš ï¸';
        else hydrationStatus = 'ğŸ’§';
        
        const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
        const medal = index < 3 ? medals[index] : `#${index + 1}`;
        
        return `
          <div class="team-item ${isCurrentTeam ? 'current-team' : ''}">
            <div>
              <span class="team-name">${medal} ${teamInfo.emoji} ${teamInfo.name}</span>
              <span style="margin-left: 15px;">${hydrationStatus}</span>
            </div>
            <div class="team-stats">
              <span>ğŸƒâ€â™‚ï¸ ${team.totalSteps.toLocaleString()} steps</span>
              <span>ğŸ‘¥ ${team.members.length} warriors</span>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function updateTeamMembers(teamMembers) {
      // Group by username to get unique members with accumulated stats
      const uniqueMembers = {};
      
      teamMembers.forEach(member => {
        if (!uniqueMembers[member.username]) {
          uniqueMembers[member.username] = {
            ...member,
            total_steps: 0,
            daily_entries: 0
          };
        }
        
        // Accumulate total steps from all entries for this user
        uniqueMembers[member.username].total_steps += (member.total_steps || 0);
        uniqueMembers[member.username].daily_entries++;
        
        // Keep the most recent user data (avatar, etc.)
        if (new Date(member.last_updated || 0) > new Date(uniqueMembers[member.username].last_updated || 0)) {
          uniqueMembers[member.username] = {
            ...uniqueMembers[member.username],
            ...member,
            total_steps: uniqueMembers[member.username].total_steps,
            daily_entries: uniqueMembers[member.username].daily_entries
          };
        }
      });
      
      const sortedMembers = Object.values(uniqueMembers).sort((a, b) => (b.total_steps || 0) - (a.total_steps || 0));
      
      const membersEl = document.getElementById('teamMembers');
      membersEl.innerHTML = sortedMembers.map((member, index) => {
        const isCurrentUser = member.username === currentUser.username;
        const penalty = member.sitting_hours > 4 ? `<span class="penalty-badge">-${Math.floor((member.sitting_hours - 4) * 1000)} sitting penalty</span>` : '';
        const rank = index === 0 ? 'ğŸ‘‘' : `#${index + 1}`;
        const avatar = member.avatar || 'ğŸ‘¤';
        
        return `
          <div class="member-item ${isCurrentUser ? 'current-user' : ''}">
            <span style="display: flex; align-items: center; gap: 10px;">
              <span style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 18px; color: white;">${avatar}</span>
              ${rank} ${member.username} ${isCurrentUser ? '(You)' : ''}
            </span>
            <span>ğŸƒâ€â™‚ï¸ ${(member.total_steps || 0).toLocaleString()} steps ${penalty}</span>
          </div>
        `;
      }).join('');
    }
    
    function updateJourneyMap() {
      const teams = {};
      
      allUsers.forEach(user => {
        if (!teams[user.team_id]) {
          teams[user.team_id] = 0;
        }
        teams[user.team_id] += user.total_steps || 0;
      });
      
      const journeyPath = document.getElementById('journeyPath');
      
      // Remove existing tokens
      const existingTokens = journeyPath.querySelectorAll('.team-token');
      existingTokens.forEach(token => token.remove());
      
      Object.entries(teams).forEach(([teamId, steps]) => {
        const progress = Math.min(100, (steps / TOTAL_JOURNEY_STEPS) * 100);
        const teamInfo = TEAM_TOKENS[teamId];
        
        const token = document.createElement('div');
        token.className = 'team-token';
        token.style.left = progress + '%';
        token.style.background = teamInfo.color;
        token.textContent = teamInfo.emoji;
        token.title = `${teamInfo.name}: ${steps.toLocaleString()} steps (${progress.toFixed(1)}%)`;
        
        journeyPath.appendChild(token);
      });
    }
    
    function showMessage(id, text) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.classList.remove('hidden');
    }
    
    function hideMessage(id) {
      document.getElementById(id).classList.add('hidden');
    }
    
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9999945244be8986',t:'MTc2MjMxNjY0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
